{"version":3,"sources":["tst-admin.min.js"],"names":["tst","togglePreview","button","preview","jQuery","val","show","wpCookies","set","hide","createPickerDelayed","options","input","size","createPickerDelayedHelper","setTimeout","createPicker","me","this","$","extend","image","sizes","position","x","y","gutenberg","init","mouseIsDown","isLoading","imageContainer","children","imageOverlay","crosshair","append","imageObject","document","createElement","onload","i","maxSize","width","parseInt","height","attr","css","caption","div","refreshPreview","previewButtonStatus","click","scrollTop","closest","src","on","e","mousedown","addClass","change","ajaxComplete","removeClass","preventDefault","offset","pageX","left","pageY","top","setPosition","Math","max","min","length","w","h","cssW","cssH","resize","imageResizeDimensions","destroy","off","remove","html","orig_w","orig_h","dest_w","dest_h","interestX","interestY","aspect_ratio","new_w","new_h","floor","size_ratio","crop_w","round","crop_h","s_x","s_y"],"mappings":"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","file":"../tst-admin.min.js","sourcesContent":["/*\n * Copyright 2012-2024, Theia Smart Thumbnails, WeCodePixels, https://wecodepixels.com\n */\nvar tst = tst || {};\n\ntst.togglePreview = function (button) {\n    var preview = jQuery('.theiaSmartThumbnails_mediaUpload ._preview');\n    button = jQuery(button);\n\n    if (button.val() == 'Show Preview') {\n        button.val('Hide Preview');\n        preview.show();\n        if (wpCookies) {\n            wpCookies.set('theiaSmartThumbnails_showPreview', 'true');\n        }\n    } else {\n        button.val('Show Preview');\n        preview.hide();\n        if (wpCookies) {\n            wpCookies.set('theiaSmartThumbnails_showPreview', 'false');\n        }\n    }\n};\n\n// Create picker only after DOM elements have been added.\ntst.createPickerDelayed = function (options) {\n    if (jQuery(options.input).size() > 0) {\n        tst.createPickerDelayedHelper(options);\n    } else {\n        setTimeout(function (options) {\n            return function () {\n                tst.createPickerDelayed(options);\n            };\n        }(options), 50);\n    }\n};\n\ntst.createPickerDelayedHelper = function (options) {\n    jQuery(\".compat-field-theiaSmartThumbnails_position\").hide();\n    tst.createPicker(options);\n};\n\ntst.createPicker = function (options) {\n    var me = this,\n        $ = jQuery,\n        defaults = {\n            image: '',\n            input: '',\n            preview: '',\n            sizes: [],\n            position: {\n                x: 0.5,\n                y: 0.5\n            },\n            gutenberg: false\n        };\n    me.options = $.extend(defaults, options);\n\n    // Initialization function\n    me.init = function () {\n        me.mouseIsDown = false;\n        me.isLoading = false;\n        me.position = me.options.position;\n        me.input = $(me.options.input);\n        me.imageContainer = $(me.options.image);\n        me.image = me.imageContainer.children('img');\n        me.imageOverlay = $('<div class=\"_overlay\">');\n        me.crosshair = $('<div class=\"_crosshair tst-icon-target2\">');\n        me.preview = $(me.options.preview);\n        me.imageContainer.append(me.crosshair, me.imageOverlay);\n\n        // Load image.\n        me.imageObject = document.createElement('img');\n        me.imageObject.onload = (function (me) {\n            return function () {\n                var i, size;\n\n                // Keep an upper size limit for the thumbnails.\n                var maxSize = me.imageContainer.width() - 4;\n                for (i in me.options.sizes) {\n                    size = me.options.sizes[i];\n\n                    size.width = parseInt(size.width);\n                    size.height = parseInt(size.height);\n\n                    if (size.width > size.height) {\n                        if (size.width > maxSize) {\n                            size.height = size.height / size.width * maxSize;\n                            size.width = maxSize;\n                        }\n                    } else {\n                        if (size.height > maxSize) {\n                            size.width = size.width / size.height * maxSize;\n                            size.height = maxSize;\n                        }\n                    }\n\n                    me.options.sizes[i] = size;\n                }\n\n                // Create preview elements for each size\n                for (i in me.options.sizes) {\n                    size = me.options.sizes[i];\n                    size.image = $('<img src=\"' + me.image.attr('src') + '\">');\n                    size.imageContainer = $('<div class=\"_imageContainer\">')\n                        .css({\n                            width: size.width,\n                            height: size.height\n                        })\n                        .append(size.image);\n                    size.caption = $('<div class=\"_caption\">' + i + '</div>');\n                    size.div = $('<div>')\n                        .append(size.imageContainer, size.caption);\n                    me.preview.append(size.div);\n                }\n\n                // Refresh previews.\n                me.refreshPreview();\n                me.crosshair.css('display', 'block');\n\n                // Set preview button status.\n                if (tst.previewButtonStatus) {\n                    jQuery('.theiaSmartThumbnails_mediaUpload ._previewButton')\n                        .val(tst.previewButtonStatus)\n                        .click()\n                        .click();\n                }\n\n                // Set container scrollTop.\n                if (tst.scrollTop) {\n                    me.input.closest('.attachment-info').scrollTop(tst.scrollTop);\n                    tst.scrollTop = null;\n                }\n            };\n        })(me);\n        me.imageObject.src = me.image.attr('src');\n\n        // Mouse events\n        $(document)\n            .on('mousemove.theiaSmartThumbnails', function (e) {\n                if (me.mouseIsDown) {\n                    me.mousedown(e);\n                }\n            })\n            .on('mouseup.theiaSmartThumbnails', function () {\n                if (me.mouseIsDown) {\n                    me.mouseIsDown = false;\n\n                    // Inside a modal window in WordPress 3.5 or above?\n                    if (\n                        jQuery(\".version-3-4\").size() === 0 &&\n                        me.input.closest(\".media-modal\").size() === 1\n                    ) {\n                        // Is it readonly (e.g. contributor role)?\n                        if (jQuery('label.setting[data-setting=\"title\"] input').attr('readonly') == 'readonly') {\n                            return;\n                        }\n\n                        me.isLoading = true;\n\n                        // Remember scroll position and preview button status.\n                        tst.scrollTop = me.input.closest('.attachment-info').scrollTop();\n                        tst.previewButtonStatus = jQuery('.theiaSmartThumbnails_mediaUpload ._previewButton').val();\n\n                        // Display loader.\n                        me.imageOverlay.addClass('_loader');\n\n                        // Fire change event, which will fire an AJAX request.\n                        me.input.change();\n                    }\n\n                    // Inside Gutenberg?\n                    if (me.options.gutenberg) {\n                        me.isLoading = true;\n                        me.imageOverlay.addClass('_loader');\n                        me.input.change();\n                    }\n                }\n            });\n        me.imageOverlay\n            .on('mousedown.theiaSmartThumbnails', function (e) {\n                if (!me.isLoading) {\n                    me.mouseIsDown = true;\n                    me.mousedown(e);\n                }\n            })\n            .on('mousemove.theiaSmartThumbnails', function (e) {\n                if (me.mouseIsDown) {\n                    me.mousedown(e);\n                }\n            });\n\n        // When using the Advanced Custom Fields plugin, we need to hide the loader manually.\n        if (!me.options.gutenberg) {\n            $(document).ajaxComplete(function (me) {\n                return function () {\n                    me.isLoading = false;\n                    me.imageOverlay.removeClass('_loader');\n                };\n            }(me));\n        }\n    };\n\n    me.mousedown = function (e) {\n        e.preventDefault();\n        var offset = me.image.offset(),\n            x = e.pageX - offset.left,\n            y = e.pageY - offset.top;\n        me.setPosition(x, y);\n    };\n\n    // Set x and y position.\n    me.setPosition = function (x, y) {\n        me.position.x = Math.max(0, Math.min(1, x / me.image.width()));\n        me.position.y = Math.max(0, Math.min(1, y / me.image.height()));\n        if (me.input.length == 1) {\n            me.input.val('[' + me.position.x + ',' + me.position.y + ']');\n        } else if (me.input.length == 2) {\n            $(me.input[0]).val(me.position.x);\n            $(me.input[1]).val(me.position.y);\n        }\n        me.refreshPreview();\n    };\n\n    // Refresh all the previews.\n    me.refreshPreview = function () {\n        me.crosshair.css({\n            left: me.position.x * me.image.width(),\n            top: me.position.y * me.image.height()\n        });\n        for (var i in me.options.sizes) {\n            var size = me.options.sizes[i];\n            var resize = tst.imageResizeDimensions(me.imageObject.width, me.imageObject.height, size.width, size.height, me.position.x, me.position.y);\n            var w, h, cssW, cssH;\n            if (me.imageObject.width - resize[6]) {\n                w = me.imageObject.width / me.imageObject.height * resize[5];\n                h = resize[5];\n                cssW = 'auto';\n                cssH = resize[5];\n            } else {\n                w = resize[4];\n                h = me.imageObject.height / me.imageObject.width * resize[4];\n                cssW = resize[4];\n                cssH = 'auto';\n            }\n            size.image.css({\n                left: -resize[2] / me.imageObject.width * w,\n                top: -resize[3] / me.imageObject.height * h,\n                width: cssW,\n                height: cssH\n            });\n        }\n    };\n\n    this.destroy = function () {\n        $(document)\n            .off('mousemove.theiaSmartThumbnails')\n            .off('mouseup.theiaSmartThumbnails');\n\n        me.imageOverlay\n            .off('mousedown.theiaSmartThumbnails')\n            .off('mousemove.theiaSmartThumbnails');\n\n        me.crosshair.remove();\n        me.imageOverlay.remove();\n        me.preview.html('');\n    };\n\n    // Initialize.\n    me.init();\n};\n\n// Calculates the resize box. Similar to WordPress's image_resize_dimensions.\ntst.imageResizeDimensions = function (orig_w, orig_h, dest_w, dest_h, interestX, interestY) {\n    var aspect_ratio = orig_w / orig_h;\n    var new_w = Math.min(dest_w, orig_w);\n    var new_h = Math.min(dest_h, orig_h);\n\n    if (!new_w) {\n        new_w = Math.floor(new_h * aspect_ratio);\n    }\n\n    if (!new_h) {\n        new_h = Math.floor(new_w / aspect_ratio);\n    }\n\n    var size_ratio = Math.max(new_w / orig_w, new_h / orig_h);\n\n    var crop_w = Math.round(new_w / size_ratio);\n    var crop_h = Math.round(new_h / size_ratio);\n\n    var s_x = Math.floor((orig_w - crop_w) * interestX);\n    var s_y = Math.floor((orig_h - crop_h) * interestY);\n\n    return [0, 0, Math.round(s_x), Math.round(s_y), Math.round(new_w), Math.round(new_h), Math.round(crop_w), Math.round(crop_h)];\n};\n"]}